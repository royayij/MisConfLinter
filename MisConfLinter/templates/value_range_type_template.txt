from typing import TYPE_CHECKING, Any, Dict, Union
# Auto Generated Rules. Do not change manually
from ansiblelint.rules import AnsibleLintRule
import re

if TYPE_CHECKING:
    from typing import Optional

    from ansiblelint.file_utils import Lintable

class {{rule_name}}(AnsibleLintRule):
    id = '{{rule_id}}'
    shortdesc = '{{rule_desc_short}}'
    description = '{{rule_desc}}'
    tags = ['{{misconfiguration_type}}']
    param_value_ranges ={{value_ranges}}

    param_type = {{basic_type}}

    _modules = ['{{modules_sel}}']

    def check_values(self, param_value: {{basic_type}}, values: dict):
        try:
            if any(k in values for k in ['max', 'less']):
                max_val = values.get('max') or values.get('less')
                max_val = float(max_val)
                if float(param_value) <= max_val:
                    return True

            if any(k in values for k in ['min', 'greater']):
                min_val = values.get('min') or values.get('greater')
                min_val = float(min_val)
                if float(param_value) >= min_val:
                    return True

            if any(k in values for k in ['range', 'between']):
                range_vals = values.get('range') or values.get('between')
                # Ensure range_vals is a tuple like ('10', '20')
                if isinstance(range_vals, (list, tuple)) and len(range_vals) == 2:
                    low = float(range_vals[0])
                    high = float(range_vals[1])
                    if (low <= float(param_value)) &  (float(param_value)<= high):
                        return True

        except Exception:
            return False

        return False

    def matchtask(
        self, task: Dict[str, Any], file: 'Optional[Lintable]' = None
    ) -> Union[bool, str]:
        if task["action"]["__ansible_module__"].split('.')[-1] in self._modules:
            value = task['action'].get('{{parameter_name}}', None)
            return not self.check_values(value, self.param_value_ranges)
        return False